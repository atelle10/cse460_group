{% extends 'base.html' %}

{% block title %}Student Portal{% endblock %}

{% block content %}

{% if success %}
<div class="alert alert-success">
    {{ success }}
</div>
{% endif %}

<h2>Student Portal</h2>

<div class="action-buttons">
    {% if not is_club_leader %}
        <a href="{% url 'student_home' %}?action=apply" class="button">Create New Club</a>
    {% else %}
        <a href="{% url 'club_leader_dashboard' %}" class="button">Manage My Club</a>
    {% endif %}
</div>

<div class="tabs">
    <button onclick="showTab('clubs')" id="clubs-tab" class="tab-button active">
        Clubs
    </button>
    <button onclick="showTab('events')" id="events-tab" class="tab-button inactive">
        Events
    </button>
</div>


<div id="clubs-content">
    <h3>My Clubs</h3>

    {% if my_clubs %}
        {% for club in my_clubs %}
        <div class="club-card">
            <h4>
                <a href="{% url 'club_detail' club.club_id %}">{{club.name}}</a>
            </h4>
            <p>{{club.description}}</p>

            <div class="club-info">
                <p><strong>Location:</strong> {{club.location}}</p>
                <p><strong>Categories:</strong> {{club.categories|join:", "}}</p>
                <p><strong>Members:</strong> {{club.members_count}}</p>
            </div>
        </div>
        {% endfor %}
    {% else %}
        <p class="text-muted">You haven't joined any clubs yet.</p>
    {% endif %}

    <h3>Available Clubs</h3>

    {% if clubs %}
        {% for club in clubs %}
        <div class="club-card">
            <h4>
                <a href="{% url 'club_detail' club.club_id %}">{{club.name}}</a>
            </h4>
            <p>{{club.description}}</p>

            <div class="club-info">
                <p><strong>Location:</strong> {{club.location}}</p>

                <p><strong>Categories:</strong> {{club.categories|join:", "}}</p>


                <p><strong>Members:</strong> {{club.members_count}}</p>
            </div>
        </div>
        {% endfor %}
    {% else %}
        <p class="text-muted">No clubs yet. Be the first to start one!</p>
    {% endif %}
</div>

<div id="events-content" class="events-hidden">
    <h3>Upcoming Events</h3>

    <div class="filter-sort-section" style="background: #f5f5f5; padding: 15px; border-radius: 4px; margin-bottom: 20px;">
        <form method="GET" action="{% url 'student_home' %}" id="event-filter-form">
            <input type="hidden" name="tab" value="events">

            <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; margin-bottom: 10px;">
                <div>
                    <label style="display: block; margin-bottom: 5px; font-weight: bold;">Search</label>
                    <input type="text" name="search" placeholder="Search events..." value="{{ search_query }}" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                </div>

                <div>
                    <label style="display: block; margin-bottom: 5px; font-weight: bold;">Location</label>
                    <input type="text" name="location" placeholder="Filter by location" value="{{ filter_location }}" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                </div>

                <div>
                    <label style="display: block; margin-bottom: 5px; font-weight: bold;">Sort By</label>
                    <select name="sort" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                        <option value="date_asc" {% if sort_by == 'date_asc' %}selected{% endif %}>Date (Earliest)</option>
                        <option value="date_desc" {% if sort_by == 'date_desc' %}selected{% endif %}>Date (Latest)</option>
                        <option value="popularity" {% if sort_by == 'popularity' %}selected{% endif %}>Popularity</option>
                        <option value="name" {% if sort_by == 'name' %}selected{% endif %}>Name (A-Z)</option>
                    </select>
                </div>
            </div>

            <div style="display: flex; gap: 10px; align-items: center; justify-content: flex-end;">
                <button type="submit" class="btn" style="padding: 8px 20px;">Apply Filters</button>
                <a href="{% url 'student_home' %}?tab=events" class="btn btn-secondary" style="padding: 8px 20px; text-decoration: none; display: inline-block;">Clear Filters</a>
            </div>
        </form>
    </div>

    {% if events %}
        {% for event in events %}
        <div class="club-card">
            <h4>
                <a href="{% url 'event_detail' event.event_id %}">{{ event.title }}</a>
            </h4>
            <p>{{ event.description }}</p>

            <div class="club-info">
                <p><strong>Club:</strong> <a href="{% url 'club_detail' event.club.club_id %}">{{ event.club.name }}</a></p>
                <p><strong>Date:</strong> {{ event.start_time|date:"M d, Y" }}</p>
                <p><strong>Time:</strong> {{ event.start_time|date:"g:i A" }} - {{ event.end_time|date:"g:i A" }}</p>
                <p><strong>Location:</strong> {{ event.location }}</p>
            </div>
        </div>
        {% endfor %}
    {% else %}
        <p class="text-muted">No events scheduled at this time.</p>
    {% endif %}
</div>


<script>
function showTab(tab) {
    const clubsContent = document.getElementById('clubs-content');
    const eventsContent = document.getElementById('events-content');
    const clubsTab = document.getElementById('clubs-tab');
    const eventsTab = document.getElementById('events-tab');

    if (tab === 'clubs') {
        clubsContent.style.display = 'block';
        eventsContent.style.display = 'none';

        clubsTab.classList.add('active');
        clubsTab.classList.remove('inactive');

        eventsTab.classList.add('inactive');
        eventsTab.classList.remove('active');
    } else if (tab === 'events') {
        clubsContent.style.display = 'none';
        eventsContent.style.display = 'block';

        clubsTab.classList.add('inactive');
        clubsTab.classList.remove('active');

        eventsTab.classList.add('active');
        eventsTab.classList.remove('inactive');
    }
}

const urlParams = new URLSearchParams(window.location.search);
if (urlParams.get('tab') === 'events') {
    showTab('events');
}
</script>

{% endblock %}
